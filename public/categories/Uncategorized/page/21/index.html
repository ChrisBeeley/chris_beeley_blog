<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head><script src="/chris_beeley_blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=chris_beeley_blog/livereload" data-no-instant defer></script>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Uncategorized - Chris Beeley&#39;s blog</title>
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Chris Beeley\u0027s blog",
    
    "url": "http:\/\/localhost:1313\/chris_beeley_blog\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "http:\/\/localhost:1313\/chris_beeley_blog\/"
  
  
  
  
}
</script>

<meta property="og:url" content="http://localhost:1313/chris_beeley_blog/categories/Uncategorized/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Chris Beeley&#39;s blog">
   
<link rel="apple-touch-icon" sizes="180x180" href=" http://localhost:1313/chris_beeley_blog/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/chris_beeley_blog/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/chris_beeley_blog/favicon/favicon-16x16.png">


<meta name="generator" content="Hugo 0.124.1"><link rel="alternate" href="http://localhost:1313/chris_beeley_blog/index.xml" type="application/rss+xml" title="Chris Beeley&#39;s blog">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<link rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/main.css">
<link disabled id="dark-mode-theme" rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/dark.css"><link rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/syntax.css"><link rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/codeblock.css">




  </head>
  <body>
    
<div class="container fixed-top">
  <div class="row justify-content-center">
    <div class="col-sm-12 col-md-12 col-lg-10 col-xl-10">

      <nav class="navbar navbar-expand-lg navbar-light fixed-top p-0">
        <div class="container">
          
          <a class="navbar-brand fw-bold" href="http://localhost:1313/chris_beeley_blog/">Chris Beeley&#39;s blog</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav mb-2 mb-lg-0">
              

              
              <li class="nav-item nav-link">
                <a id="dark-mode-toggle" class="bi bi-sun"></a>
              </li>
              
            </ul>
          </div>
        </div>
      </nav>

    </div>
  </div>
</div>
    









<header class="header-section ">

  <div class="intro-header no-img mt-10">
    <div class="container">
      <div class="row justify-content-center">
        

          
          <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
            

            <div class="categories-heading">
              

              

              

              
              

              

              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-md-12">
       
      <div class="row">
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=551/">
            <div class="card-body">

                <h3 class="fw-bold post-title">The internet platform of the future</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;November 30, 2013 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>I recently sent the following to the New Statesman in response to a piece they recently carried which weighed up the likely fortunes of Google, Facebook, and Apple, and asked which would be the internet platform of the future. It is quite obvious to me that we already have the internet platform of the future, and it‚Äôs called Linux. They ran it, edited, in the letters page, but they don‚Äôt publish letters online so here, for the first time, live and unplugged, is the unexpurgated version.</p>
<p>‚ÄúI read the recent ‚ÄúIs Apple dying?‚Äù with great interest- a sound analysis of the woes of the increasingly less mighty Apple. It‚Äôs interesting that even in the pages of the New Statesman, however, the value of something is ignored unless it is profitable. For we already have ‚ÄúThe internet platform of the future‚Äù. We have long had it and it shows no sign of weakening in the future. It‚Äôs called Linux. It‚Äôs totally free and so turns no profit for shareholders, but it ceaselessly and tirelessly grows and develops, a product of a global community that believes in the true values of the internet. The internet as we know it today would be quite impossible without Linux- could Apple and Facebook say the same? Google perhaps could, but it‚Äôs interesting to note their heavy use of Linux, most notably within the Android operating system.‚Äù</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=537/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Free and open source software. Come for the free, stay for the awesome</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;November 8, 2013 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>I just wrote this for the Institute of Mental Health <a href="http://imhblog.wordpress.com/">blog</a> so I thought I may as well cross-post here. I promise I will talk about something other than Shiny soon üôÇ</p>
<p>Open source software refers to software whose code is available for anybody to view, revise and reuse. This should be contrasted with closed or proprietary code which is known only to the manufacturer, and who will often charge a fee for individuals to use the software (for example, Microsoft Word, or Adobe Photoshop).</p>
<p>There are many types of open source licence but the principle of viewing, revising, and reusing underpins them all. On the face of it, this does not seem like a very exciting proposition, and newcomers to the concept often wonder what difference such an apparently obscure part of software licensing could make.</p>
<p>However, because open source software (often, although not always, available at no cost, and referred to as Free and Open Source Software or FOSS) can be modified by anybody it offers a number of advantages over traditional proprietary software.</p>
<p>Firstly, FOSS is free. I‚Äôm writing this blog post on a computer which contains absolutely no software of any kind that costs any money whatsoever. I shall repost it on my self-hosted blog which runs on a server which itself contains no software of any kind that costs any money whatsover. In a time of austerity, the availability of free software that can perform all the tasks of paid software should be a deafening clarion call across the public sector. And indeed FOSS is starting to gain traction in <a href="http://opensource.com/education/13/9/back-to-school-with-open-source">education</a> and <a href="http://jamia.bmj.com/content/early/2013/06/05/amiajnl-2013-001671.full.pdf?keytype=ref&amp;ijkey=ZhXd44bC9z9a7gr">health</a>.</p>
<p>However, not only this, but FOSS is often better than its paid counterpart. This is because anybody can change and improve it, and whole communities exist around popular tools, adding new features and fixing bugs continuously with everyone inside and outside of the community benefiting. The FOSS operating system Linux basically <a href="http://www.pcmech.com/article/would-the-internet-exist-without-linux/">runs the internet</a>. The closed source Microsoft Excel, notoriously, features bugs that Microsoft can‚Äôt or won‚Äôt fix (e.g. <a href="http://andrewgelman.com/2013/04/17/excel-bashing/">here</a>, <a href="http://homepage.cs.uiowa.edu/~jcryer/JSMTalk2001.pdf">here</a>). Even the US Military are making ever larger use of <a href="http://news.cnet.com/8301-13505_3-9872263-16.html">open source sotware</a>.</p>
<p>The statistical programming language <a href="http://cran.r-project.org/">R</a> is another success story from the FOSS world. Precisely because it is free and open source, a huge community of statisticians, programmers, data visualisers and analysts all contribute to its development. At the time of writing there are nearly 5000 user contributed packages within R, which help users with tasks as diverse as computational chemistry and physics, finance, clinical trials, medical imaging, psychometrics, machine learning, statistical methods, and the production of extremely powerful and flexible statistical graphics. R is rapidly becoming the <a href="http://www.nytimes.com/2009/01/07/technology/business-computing/07program.html?_r=0">lingua franca</a> of analytics and is widely used in many leading <a href="http://www.revolutionanalytics.com/companies-using-r">data science departments</a>, perhaps most notably Google.</p>
<p>I have made extensive use of R in my work on Nottinghamshire Healthcare NHS Trust‚Äôs new <a href="http://feedback.nottinghamshirehealthcare.nhs.uk/">patient feedback site</a>, using R to serve both static quarterly <a href="http://feedback.nottinghamshirehealthcare.nhs.uk/report">reports</a> as well as interactive, searchable analysis of all of our <a href="http://feedback.nottinghamshirehealthcare.nhs.uk/reports/custom">feedback</a> past and present.</p>
<p>The searchable reports are made possible by the <a href="http://www.rstudio.com/shiny/">Shiny</a> package which makes it ridiculously easy to allow users to interact with a dataset. Shiny handles all of the hard work involved in programming a graphical user interface and lets analysts such as myself concentrate on the content of what is delivered to the user.</p>
<p>Although Shiny is never going to replace other methods of programming for very large, fully featured analytics platforms (for example, Google Analytics) it has certainly proved its worth on the patient feedback website and I would hope that R and Shiny would find more and more use in NHS settings up and down the country to allow Trusts to better communicate their data to the communities and service users whom they serve.</p>
<p>There are some demonstrations of what can be done with Shiny on my <a href="http://chrisbeeley.net/website/">website</a>, some are little examples I wrote just for the book but some are more fully featured than that and hopefully demonstrate some of the things which can be achieved using Shiny.</p>
<p>Over the next 10 years I hope to see more and more use of FOSS, not only for the Free, but also for the Awesome.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=520/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Quick p-values for publication</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;October 24, 2013 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>I‚Äôm afraid this is just from a lecture from the school of the totally obvious, but for some unfathomable reason I‚Äôve never got round to doing it. I‚Äôm not even telling you the code so much as just saying ‚Äúyou should definitely do this, it‚Äôs very easy‚Äù. I got the time back after writing one paper and I constantly have to fiddle around with p-values so I imagine I shall save many hours each year.</p>
<p>So if you‚Äôre writing for publication you often want to turn p-values such as 3.7-e18 into something more like ‚Äúp&lt;.0001 .0001=&quot;&quot; .001=&quot;&quot; .01=&quot;&quot; .05=&quot;&quot; .1=&quot;&quot; as=&quot;&quot; been=&quot;&quot; by=&quot;&quot; course=&quot;&quot; do=&quot;&quot; doing.=&quot;&quot; don=&quot;&quot; hand=&quot;&quot; have=&quot;&quot; href=&ldquo;<a href="http://www.stat.uni-muenchen.de/~leisch/Sweave/%22">http://www.stat.uni-muenchen.de/~leisch/Sweave/&quot;</a> i=&rdquo;&quot; if=&quot;&quot; is=&quot;&quot; it=&quot;&quot; language=&ldquo;R&rdquo; most=&quot;&quot; of=&quot;&quot; pvaluefunction=&ldquo;function(pValue)&rdquo; return=&quot;&quot; sometimes=&quot;&quot; tables=&quot;&quot; them.=&quot;&quot; this=&quot;&quot; this:=&quot;&quot; useful=&quot;&quot; using=&quot;&quot; whole=&quot;&quot; you=&quot;&quot;&gt;Sweave, or <a href="http://yihui.name/knitr/">knitr</a> or something like that. If you‚Äôre not doing that you should start, but that‚Äôs a different post.&lt;/.0001&gt;</p>
<p>Or you may just be outputting tables with p-values in as plain text as I wrote about in <a href="http://chrisbeeley.net/?p=230">this</a> post.</p>
<p>Boom! You‚Äôll save enough hours in your life to read the wonderful Don Quixote.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=511/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Book launch</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;October 22, 2013 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>My book has just come out, <a href="http://www.packtpub.com/web-application-development-with-r-using-shiny/book">Web Application Development with R using Shiny</a>. It‚Äôs an introduction to the marvellous <a href="http://www.rstudio.com/shiny/">Shiny</a> from the wonderful people at RStudio. Although the online documentation for Shiny does cover most of the things you might want to do with it the people who approached me about writing the book thought that having a more comprehensive guide with some worked examples would be useful. And I was inclined to agree. So I wrote the book in 3 months, which was one of the most brilliant and awful experiences of my entire life.</p>
<p>As I mentioned in a previous post, a lot of the code I wrote for the book lives on GitHub, links from my <a href="http://chrisbeeley.net/website/">website</a>. I also host all the applications on my server, so you can play with the actual applications themselves, again links are on the site.</p>
<p>The book takes you all the way from beginning with R, all the way through very basic examples of Shiny, and on through using HTML/ CSS/ JavaScript/ jQuery with Shiny, and various advanced functions like controlling reactivity, uploading and downloading files, all that kind of thing.</p>
<p>It‚Äôs a very humble contribution, really, but I would definitely have bought, read and used it when I was starting out, so I hope it goes some way to helping people use Shiny, which really to me represents a complete game-changer in the way that you can write a halfway decent application to let anybody explore your data in a <em>morning</em>.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=487/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Patient Opinion data made easy with R</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;October 19, 2013 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>As you may or may not be aware, I recently helped on the data side of <a href="http://www.nottinghamshirehealthcare.nhs.uk/">Nottinghamshire Healthcare NHS Trust‚Äôs</a> feedback website which lives <a href="http://feedback.nottinghamshirehealthcare.nhs.uk/reports/custom">here</a>. Part of this work was collecting the data we receive from the Trust-wide patient survey and bringing it in with other sources of feedback, including stories from our friends over at <a href="https://www.patientopinion.org.uk/">Patient Opinion</a>.</p>
<p>For a long time I‚Äôve queried their data using their API (documentation is <a href="%E2%80%9Dhttps://www.patientopinion.org.uk/info/api-docs%E2%80%9D">here</a>) and fiddled around with it a bit, but my XML was never quite up to doing a proper extract and getting the data into the same structure as the rest of our patient experience data. The job sort of got shelved under ‚ÄúA computer program could do this, nobody has time to write the computer program, maybe a human will do it‚Äù which to be honest is quite a large shelf groaning with the weight of a lot of stuff at the moment.</p>
<p>Anyway, we‚Äôre off to show off the website at a big meeting on Thursday and this has spurred me into action. I‚Äôve finally managed to wrangle the data into shape using, what else, the mighty <a href="http://www.cran.r-project.org/">R</a> with assistance from the <a href="http://cran.r-project.org/web/packages/RCurl/index.html">RCurl</a> and <a href="http://cran.r-project.org/web/packages/XML/index.html">XML</a>packages.</p>
<p>I confess coming from a background of not even really knowing what XML was it‚Äôs been a bit of a slog but I have got there now so I‚Äôm writing this post to help out future explorers who might face this exact problem (hey, every NHS Trust should use Patient Opinion and have an R guy wrangling the data, no question about that) or a similar one. I‚Äôm going to show you the dumb way (which I did first) and then the clever way.</p>
<p>Point number 1, which I have to say is quite a common point number 1, is this is a lot easier on Linux than it is on Windows. RCurl and XML both have various problems on Windows which I don‚Äôt understand sufficiently to explain, suffice to say if I‚Äôm doing this job I boot to Linux and you should too.</p>
<p>Point number 2 is you‚Äôre going to need an API key, just email Patient Opinion and they‚Äôll give you one. Mine will show as ‚ÄúXXXXX‚Äù in the following code so I‚Äôm afraid you won‚Äôt be able to run the code as it stands.</p>
<p>These instructions are based on an Ubuntu 13.04/ Linux Mint 15 (I‚Äôm cheating on Ubuntu with Mint at the moment) distribution, your mileage may vary, check your package management systems, etc.</p>
<p>The first thing you want to do before you launch R is make sure that the OS is set up with the libraries you need to make the RCurl and XML packages. From a terminal this is just:</p>
<p>sudo apt-get install libxml2-dev</p>
<p>sudo apt-get install libcurl4-gnutls-dev</p>
<p>Assuming these commands run okay, launch R and type at the console:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

install.packages(c(&#34;RCurl&#34;, &#34;XML&#34;))
</code></pre><p>Assuming both the packages install okay you‚Äôre ready to go. Here‚Äôs the dumb way first, which I have to say is remarkably easy.</p>
<p>My code here includes the instruction:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

getURL(&#34;https://www.patientopinion.org.uk/api/v1/opinions?healthservice=rha&amp;apikey=XXXXX&amp;take=100&#34;).
</code></pre><p>This contains two things of interest, firstly the health service code, which in our case is ‚Äúrha‚Äù. This returns just stories about my Trust. It‚Äôs pretty simple to figure yours out by looking at the search pages or if you can‚Äôt do that just ask Patient Opinion and I‚Äôm sure they‚Äôd be glad to let you know. The second is my API key, shown here as ‚ÄúXXXXX‚Äù. As I mentioned you will need to get your own API key and place it here.</p>
<p>The one final thing to mention is that the code as written here queries all of the stories that have ever been published every time. Because it‚Äôs only searching a small part of the tree it does not bother Patient Opinion‚Äôs server too much, and there‚Äôs only 900 stories at the moment so it doesn‚Äôt take too long. You can use the ‚Äúskip‚Äù function within the API (see the documentation) to only download stories you don‚Äôt currently have. I haven‚Äôt done this because I will probably move this code to a server where the process won‚Äôt have write permissions, which would obviously break it, so it just seems like wasted effort. In time I will probably look at getting write permissions for the process on the server (which I don‚Äôt manage) and changing the code but it‚Äôs not really a priority.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

library(RCurl)
library(XML)

lappend &lt;- function(lst, obj) { # this is a function I stole from somewhere years ago to stick list items together

  lst[[length(lst)+1]] &lt;- obj ; return(lst)

}

mylist=list(xmlToDataFrame( # download the first 100 stories

  getURL(&#34;https://www.patientopinion.org.uk/api/v1/opinions?healthservice=rha&amp;apikey=XXXXX&amp;take=100&#34;)

))

skip = 100 # initialise a variable to download the next 100

result = NULL # this will be used to check for errors in the download, i.e. are there any stories left

while(class(result) != &#34;try-error&#34;) { # while no errors, i.e. while API still has more stories

  result = try(
    xmlToDataFrame(getURL(paste(&#34;https://www.patientopinion.org.uk/api/v1/opinions?healthservice=rha&amp;apikey=XXXX&amp;skip=&#34;,
    skip, &#34;&amp;take=100&#34;, sep=&#34;&#34;)))
)

if (class(result) != &#34;try-error&#34;) mylist=lappend(mylist, result)  # if there are stories, stick them onto the end of the list

  skip=skip+100 # get the next 100 stories next time

}

fine=do.call(&#34;rbind&#34;, mylist) # stick all the stories together in a dataframe

write.csv(fine, file=&#34;~/PO.csv&#34;) # export a spreadsheet
</code></pre><p>This is the dumb way, and will return a dataframe with all the stories in, as well as dates, responses, and some other stuff. For the dumb way it‚Äôs pretty good but the problem I had was that is stuck all the information about the service (the NACS code which is a unique identifier for each service) together with the other stuff about the service (what it‚Äôs called, where it is) together. Pulling the NACS code to match it with our database seemed a bit tricky, but more seriously whenever more than one service is mentioned in a story, the whole thing got stuck together, both NACS codes, addresses, everything. I really didn‚Äôt think I could handle these cases accurately. So this weekend I took the plunge and decided to parse the XML properly myself.</p>
<p>I didn‚Äôt want much really from all the data, just the story itself, the date, and the NACS code for matching purposes.</p>
<p>In order to make it work, I had to learn a little bit about XPath, which the XML package makes use of, and of which I have never previously heard. There are various tutorials on the internet, such as <a href="http://www.tizag.com/xmlTutorial/xpathtutorial.php">here</a> and <a href="http://manual.calibre-ebook.com/xpath.html">here</a>. It seems like one of those very deep things but you can learn what you need for this task in half an hour.</p>
<p>Once you‚Äôve got the hang of XPath, it‚Äôs just a case of downloading 100 stories, stepping through the XML to find the nodes you‚Äôre interested in using XPath and then sticking it all together in a dataframe. The problem I had at first is that there are 100 stories exactly, but slightly more NACS codes, because of the multiple services problem I mentioned above. I dealt with this by repeating each story as many times as there are unique NACS codes for that story. This makes the number of stories and NACS codes equal. You can then combine them into two columns of a spreadsheet, each story being identified with as many codes as were identified in that story. Using the same while loop as before gets all the stories off the API.</p>
<p>Finally I have another spreadsheet where I‚Äôve made a lookup table between the NACS codes and our internal service codes we use on the survey. Again, you can either figure out the service codes from Patient Opinion by using the search function and seeing what comes back or just ask Patient Opinion nicely and I‚Äôm sure they‚Äôll be glad to help. Merging the two brings back all the stories that match with our database.</p>
<p>Here‚Äôs the code:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

library(RCurl)
library(XML)

###################################
######## DATA READ FROM API #######
###################################

### set the initial value of skip and make an empty dataframe and empty XML to keep everything

skip = 0

myFrame = data.frame()

myXML=NULL

### for as long as the API returns results, parse XML, convert to dataframe, and stick together dataframes

while(class(myXML) != &#34;try-error&#34;) {

  myXML = try(
    getURL(paste(&#34;https://www.patientopinion.org.uk/api/v1/opinions?healthservice=rha&amp;apikey=XXXX&amp;skip=&#34;,
    skip, &#34;&amp;take=100&#34;, sep=&#34;&#34;))
  )

  nodes = xmlParse(myXML)

  ### note the use of *[local-name() = &#39;XXX&#39;]
  ### this is because I couldn&#39;t get the namespace working

  opinion = xpathApply(nodes, &#34;//*[local-name() = &#39;Opinion&#39;]/*[local-name() = &#39;Body&#39;]&#34;, xmlValue)

  date = substr(unlist(xpathApply(nodes, &#34;//*[local-name() = &#39;Opinion&#39;]/*[local-name() = &#39;dtSubmitted&#39;]&#34;, xmlValue)), 1, 10)

  service = xpathSApply(nodes, &#34;//*[local-name() = &#39;NACS&#39;]&#34;, xmlValue)

  sizes = xpathSApply(nodes, &#34;//*[local-name() = &#39;HealthServices&#39;]&#34;, xmlSize)

  ### this function exists because some stories have more than one NACS code.
  ### So what it does is repeats stories (using the size variable)
  ### to make it the same length as the NACS, meaning stories are
  ### doubled next to each unique NACS. Then you can cbind

  listMat = mapply(function(x, y, z){
  
    rep(c(x, z), y)

  }, opinion, sizes, date)

  finalMat = matrix(unlist(listMat), ncol=2, byrow=TRUE)

  colnames(finalMat) = c(&#34;Story&#34;, &#34;Date&#34;)

  final = data.frame(finalMat, &#34;NACS&#34; = unlist(service))

  if (class(myXML) != &#34;try-error&#34;) myFrame = rbind(myFrame, final)

  skip=skip+100

}

###################################
######## match up NACS codes ######
###################################

POLookup = read.csv(&#34;poLookup.csv&#34;)

test = merge(myFrame, POLookup, by = &#34;NACS&#34;)

write.csv(test, file = &#34;POFinal.csv&#34;)
</code></pre><p>That‚Äôs it! I managed to match about 700 out of 900 stories this way, some of them are matched to rather larger service areas than we would like but honestly I think that‚Äôs the data‚Äôs fault. I hope that having done this we will now try to set aside a bit of time to work with Patient Opinion to improve the way our services are classified (just to be clear, this task is completely on us and Patient Opinion have been very helpful throughout with this complicated and onerous task).</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=481/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Some examples of Shiny with HTML, CSS, JavaScript, and jQuery</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;September 17, 2013 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>It‚Äôs becoming rather <a href="http://www.rstudio.com/shiny/">Shiny</a>-centric, this blog, I know, but I just put some little demos about how to use Shiny with HTML, CSS, JavaScript, and jQuery, just some toy examples with links to source, up on the <a href="http://chrisbeeley.net/website/">website</a>.</p>
<p>So if you‚Äôre interested in Shiny go have a look. Each has a link to the interactive version and the source. Do note that there are easier/ better ways of doing some of these things (row highlighting can be done in CSS rather than jQuery, e.g.); these are really just for educational purposes.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
      </div>
    </div>
  </div>
</div>

<div class="container">
 <div class="row font-sans"> 
   <div class="col-md-12 mt-10">
      <nav aria-label="Page navigation"> 
      <ul class= "pagination justify-content-end">    
      
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/20/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/19/" aria-label="Page 19" class="page-link" role="button">19</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/20/" aria-label="Page 20" class="page-link" role="button">20</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 21" class="page-link" role="button">21</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/22/" aria-label="Page 22" class="page-link" role="button">22</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/23/" aria-label="Page 23" class="page-link" role="button">23</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/22/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/29/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul> 
      </ul>
      </nav> 
    </div>
  </div>
</div>


    


<footer>

  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <ul
          class="list-inline list-group list-group-horizontal text-center footer-links d-flex justify-content-center flex-row">

          
          
        </ul>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
          2023
          

          
          &nbsp;&bull;&nbsp;
          <a href="http://localhost:1313/chris_beeley_blog/">Chris Beeley&#39;s blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          Powered by <a href="https://gohugo.io">Hugo</a> & <a href="https://github.com/binokochumolvarghese/lightbi-hugo">Lightbi.</a>&nbsp; Made with ‚ù§ by <a href="https://binovarghese.com">Bino</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script><script src="http://localhost:1313/chris_beeley_blog/js/dark-mode.js"></script>
    
  </body>
</html>

