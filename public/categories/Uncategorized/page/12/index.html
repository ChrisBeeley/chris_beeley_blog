<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head><script src="/chris_beeley_blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=chris_beeley_blog/livereload" data-no-instant defer></script>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Uncategorized - Chris Beeley&#39;s blog</title>
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Chris Beeley\u0027s blog",
    
    "url": "http:\/\/localhost:1313\/chris_beeley_blog\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "http:\/\/localhost:1313\/chris_beeley_blog\/"
  
  
  
  
}
</script>

<meta property="og:url" content="http://localhost:1313/chris_beeley_blog/categories/Uncategorized/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Chris Beeley&#39;s blog">
   
<link rel="apple-touch-icon" sizes="180x180" href=" http://localhost:1313/chris_beeley_blog/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/chris_beeley_blog/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/chris_beeley_blog/favicon/favicon-16x16.png">


<meta name="generator" content="Hugo 0.124.1"><link rel="alternate" href="http://localhost:1313/chris_beeley_blog/index.xml" type="application/rss+xml" title="Chris Beeley&#39;s blog">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<link rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/main.css">
<link disabled id="dark-mode-theme" rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/dark.css"><link rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/syntax.css"><link rel="stylesheet" href="http://localhost:1313/chris_beeley_blog/css/codeblock.css">




  </head>
  <body>
    
<div class="container fixed-top">
  <div class="row justify-content-center">
    <div class="col-sm-12 col-md-12 col-lg-10 col-xl-10">

      <nav class="navbar navbar-expand-lg navbar-light fixed-top p-0">
        <div class="container">
          
          <a class="navbar-brand fw-bold" href="http://localhost:1313/chris_beeley_blog/">Chris Beeley&#39;s blog</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav mb-2 mb-lg-0">
              

              
              <li class="nav-item nav-link">
                <a id="dark-mode-toggle" class="bi bi-sun"></a>
              </li>
              
            </ul>
          </div>
        </div>
      </nav>

    </div>
  </div>
</div>
    









<header class="header-section ">

  <div class="intro-header no-img mt-10">
    <div class="container">
      <div class="row justify-content-center">
        

          
          <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
            

            <div class="categories-heading">
              

              

              

              
              

              

              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-md-12">
       
      <div class="row">
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=1077/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Securing Shiny Server over SSL with Apache on Ubuntu</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;March 22, 2018 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>Well, I couldn’t find a guide for precisely this on the Internet, securing your Shiny Server over SSL (with Apache), but I did find the following links which were very useful and which I only adapted slightly.</p>
<p>Do have a read of the following if you’re so inclined, they’re both very useful, but neither told me exactly what to do.</p>
<p><a href="https://ipub.com/shiny-https/">https://ipub.com/shiny-https/</a><br>
<a href="https://support.rstudio.com/hc/en-us/articles/213733868-Running-Shiny-Server-with-a-Proxy">https://support.rstudio.com/hc/en-us/articles/213733868-Running-Shiny-Server-with-a-Proxy</a></p>
<p>This guide is for Ubuntu but I imagine the configuration will work on any Apache server. You’ll just need to figure out what the equivalent terminal commands are for whatever OS you’re using.</p>
<p>Even though the changes I’ve made to the config files were quite small I really knew nothing about Apache configuration at all so it’s been a bit of a trial. I’ll try to give a bit of explanation in case it helps you to know what you’re actually doing and show the changes to the config files to make it all work.</p>
<p>I will start with a disclaimer that I am just a dumb guy on the internet. I make no claims as to exactly how secure this is, whether it’s possible to bypass it, any of that. If you’re really interested in security and you don’t know what you’re doing I suggest you pay a security expert to help you. I am many things but a security expert is not one of them. I suppose I should say also that this might not even be the “correct” way to configure Apache. There are lots of different rules of thumb and general guidelines as to what goes where (it still works the other way, it’s just a way of organising things and having a generalisable approach) and I’ve ignored some of them to make this simpler. I’m not a sysadmin so I’ve rather gone with what works rather than what the industry standard is. Again, if that bothers you you’d better pay someone cleverer than me to tell you.</p>
<p>With all that said, let’s begin. The principle of what you’re doing is pretty simple. When you set up your Shiny Server you set it listening on port 3838, by default, or some other port. So now, when people go to, say, chrisbeeley.net:3838 Shiny hears them and delivers whatever it is they ask for. In the meantime Apache is listening on port 80. Every time someone points a web browser at chrisbeeley.net it hollers on port 80 and Apache hears it, and returns a web page. You don’t want that. Shiny isn’t secure over port 3838. What you want is a secure connection with Apache, that then forwards a request on to Shiny.</p>
<p>What we’re going to do is very simple. We’re going to have Apache continue to listen on port 80. However, when someone does go to port 80 Apache will send them to 443, which is secure. Apache already serves my blog with WordPress on chrisbeeley.net/ and my website (which needs an update, I know *embarrassed emoji*) on chrisbeeley.net/website. We’re going to have Apache proxy for Shiny Server whenever anyone goes to chrisbeeley.net/shinyapps.</p>
<p>Whenever someone goes to /shinyapps, Apache will say to them “Oh, you want the other guy, sure”. Apache then shouts over to Shiny Server (on port 3838/shinyapps) “Hey! Shiny Server! This guy wants some graphs and whatnot!”. And Shiny Server hears, because they’re listening on 3838/shinyapps, and shouts back “Sure! Here you go!”. And back and forth they go as you click around the application.</p>
<p>We’re going to listen on port 3838/shinyapps, rather than just on plain 3838, because if you don’t, the index page of apps you can optionally display when someone navigates to plain old 3838, instead of 3838/your-app-here doesn’t work properly- all the links to applications are 3838/the-application rather than 3838/shinyapps/the-application. For all I know there’s a better way of dealing with this problem, but this works fine and, as I already mentioned, I’m no sysadmin.</p>
<p>The big difference here from one of the blog posts that helped me to do this is that in their case the whole Apache server was just proxying for Shiny Server. They weren’t listening on port 80 for HTML, because they weren’t serving HTML with Apache. Apache listened on all the ports. I use my server as a web server, so I can’t do that.</p>
<p>So, to summarise, we’re going to have Apache listen on port 80. We’re going to redirect all requests to port 80 to port 443 (HTTPS). And we’re going to have Apache *proxy for (i.e. shout over to) the Shiny Server on this port. We’ll close the 3838 port on the firewall. Shiny Server will still listen on this port, but nobody outside the server can get to it. Only Apache can, and they will shout instructions to Shiny Server on this port, receiving graphs and buttons back which they’ll show to the user.</p>
<p>The first job is get Apache running. On Ubuntu you’re looking at:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;

sudo apt-get install apache2
sudo apt-get install -y build-essential libxml2-dev
</code></pre><p>Then run a2enmod</p>
<p>This creates a dialog, to which you respond:</p>
<p>ssl proxy proxy_ajp proxy_http rewrite deflate headers proxy_balancer proxy_connect proxy_html</p>
<p>That’s Apache taken care of, and the proxying modules set up.</p>
<p>Now you’ve done that the next job is to get an SSL certificate for your site. This used to be difficult and/ or cost money but now it is/ does neither thanks to the wonderful folks at <a href="https://letsencrypt.org/">let’s encrypt</a>. This site is incredibly easy to use, I won’t bother telling you what to do, just shell into your server and follow the instructions. You will be asked if you wish to direct all HTTP to HTTPS. Given that Google Chrome is going to start giving warning messages for *all HTTP sites, not just ones with passwords/ credit cards, now is a good time to encrypt all your traffic (<a href="https://developers.google.com/web/updates/2016/10/avoid-not-secure-warn">https://developers.google.com/web/updates/2016/10/avoid-not-secure-warn</a>). Let’s do that, the rest of this guide assumes that you do.</p>
<p>If you used to have a Shiny Server that listened on port 3838 and so had that port open, you can now close it. Unless you only want to give your users the option to use HTTPS, and leave the HTTP there for those who want it. You can do that if you want, leave the port open. I won’t go into the firewall stuff here because there are so many ways of configuring firewalls and if you press the wrong button you’ll end up blocking ssh into your server and I don’t want to be responsible for that.</p>
<p>Now for the real magic. We’re going to set up a Virtual host with Apache, on port 443, but only when someone goes to chrisbeeley.net/shinyapps (which, if they use HTTP, will be automagically redirected to HTTPS), which will then act as a proxy server for Shiny Server.</p>
<p>Before we start, it’s worth saying that you may wish to back up your config files. This is very easy. So the next file is /etc/apache2/sites-enabled/000-default-le-ssl.conf. To back it up, just:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;

sudo cp /etc/apache2/sites-enabled/000-default-le-ssl.conf /etc/apache2/sites-enabled/000-default-le-ssl.conf_BACKUP
</code></pre><p>That way, if you mess everything up, just:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;

sudo mv /etc/apache2/sites-enabled/000-default-le-ssl.conf_BACKUP /etc/apache2/sites-enabled/000-default-le-ssl.conf
</code></pre><p>And everything is back the way it started. Phew!</p>
<p>Right, on to business.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;

sudo nano /etc/apache2/sites-enabled/000-default-le-ssl.conf
</code></pre><p>This will bring up your host definition on port 443</p>
<p>There’ll already be loads of stuff at the top about port 443. Leave that alone. It knows what it’s doing. We’re going to add some stuff at the bottom.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
Stuff at the top...

ProxyPreserveHost On
ProxyPass /shinyapps http://0.0.0.0:3838/shinyapps
ProxyPassReverse /shinyapps http://0.0.0.0:3838/shinyapps
ServerName localhost

&lt;/VirtualHost&gt;
</code></pre><p>As you can see, we route everything for /shinyapps to port 3838/shinyapps.</p>
<p>You’ve done! All HTTP traffic is now routed to HTTPS. If it’s /shinyapps, it goes to Shiny Server. If not, it goes to Apache for a normal web request.</p>
<p>Well done, have a cup of tea to celebrate.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=1064/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Scraping the RStudio webinar list</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;March 8, 2018 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>I only just found this list of <a href="https://www.rstudio.com/resources/webinars/">RStudio webinars</a>, there’s loads of stuff on there, I really need to plow through a lot of it. What I really wanted was a list of them with links that I could archive and edit and rearrange so I could show which ones I am interested in, which I’ve already watched, and so on.</p>
<p>Well, if you’ve got a problem, and no-one else can help, then maybe you need… The R Team.</p>
<!-- raw HTML omitted -->
<p>Oh yes, and you’ll also need selector gadget, which is described brilliantly in this <a href="https://cran.r-project.org/web/packages/rvest/vignettes/selectorgadget.html">selector gadget vignette</a>.</p>
<p>Once you’ve got all that, the code writes itself. The only wrinkle I ironed out was that some of the HTML paths were relative, not absolute, so I paste http://blah on the front of those ones, as you’ll see.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

library(rvest)

rstudio = read_html(&#34;https://www.rstudio.com/resources/webinars/&#34;)

linkText = rstudio %&gt;%
  html_nodes(&#39;.toggle-content a&#39;) %&gt;%
  html_text()

linkURL = rstudio %&gt;%
  html_nodes(&#34;.toggle-content a&#34;) %&gt;%
  html_attr(&#34;href&#34;)

linkURL[substr(linkURL, 1, 4) != &#34;http&#34;] = 
  paste0(&#34;https://www.rstudio.com&#34;, 
         linkURL[substr(linkURL, 1, 4) != &#34;http&#34;])

cat(paste0(&#34;&lt;a href = &#34;, linkURL, &#34;&gt;&#34;, 
           linkText, &#34;&lt;/a&gt;&lt;br&gt;&#34;), file = &#34;webinar.html&#34;)
</code></pre><p>Done! Now all I did was open the resulting file and paste it into Evernote, which kept the links and text together, as you’d expect, and I can now cut and paste and markup to my heart’s desire.</p>
<p>I love it when a plan comes together.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=1057/">
            <div class="card-body">

                <h3 class="fw-bold post-title">One weird trick to getting column types right with read_csv</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;February 22, 2018 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>Using read_csv from the tidyverse is so easy that I didn’t bother to look at the <a href="https://cran.r-project.org/web/packages/readr/README.html">readr documentation</a> for a long time. However, I’m glad I did, because there is, as they say in the click bait world, one weird trick to get your column types right with read_csv. read_csv (or the other delimited file reading functions like read_tsv) does a brilliant job guessing what column types things are but by default it only looks at 1000 rows. Fine for most datasets, but actually I have more than one dataset where the first 1000 rows are missing, which doesn’t help the parser at all. So do it manually and get it right. But what a pain, all that typing, right? Wrong. Just do this:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

testSpec = read_csv(&#34;masterTest.csv&#34;)
</code></pre><p>And you’ll get this output automatically:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

Parsed with column specification:
cols(
  TeamN = col_character(),
  Time = col_integer(),
  TeamC = col_double(),
  Division = col_integer(),
  Directorate = col_integer(),
  Contacts = col_integer(),
  HIS = col_character(),
  Inpatient = col_character(),
  District = col_character(),
  SubDistrict = col_character(),
  fftCategory = col_character()
)
</code></pre><p>You’re supposed to copy and paste that into a new call, putting right any mistakes. And in fact there is one, in this very spreadsheet, the parser incorrectly guesses that Inpatient is character when it is in fact integer- because the first 1000 rows are missing.</p>
<p>So just copy all that into a new call and fix the mistake, like this:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

testSpec = read_csv(&#34;masterTest.csv&#34;, 
                    col_types = 
                      cols(TeamN = col_character(),
                           Time = col_integer(),
                           TeamC = col_double(),
                           Division = col_integer(),
                           Directorate = col_integer(),
                           Contacts = col_integer(),
                           HIS = col_character(),
                           Inpatient = col_integer(),
                           District = col_character(),
                           SubDistrict = col_character(),
                           fftCategory = col_character()
                      ))
</code></pre><p>If you’re still having problems, you can have a look using problems(testSpec).</p>
<p>Absolute pure genius. The more I use the tidyverse, the more I know about it, and the more I know about it, the more I love it.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=1047/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Analysing runs from the Polar web flow service</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;February 9, 2018 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>Well, we’re still in New Year’s resolutions territory, so what better time to have a look at using R to analyse data collected from a run? For this analysis I have used the Polar Flow web service to download two attempts at the same <a href="http://www.parkrun.org.uk/forestrec/">Parkrun</a>, recorded on a Polar M600 (which I love, by the way, if you’re looking for a running/ smartwatch recommendation).</p>
<p>The background to the analysis is in the second of the two runs I thought I was doing really well and was going to crush my PB and it ended up being exactly the same as the previous run, in terms of total time taken, but with my heart rate a lot lower.</p>
<p>But I didn’t really feel like I wasn’t pushing myself hard enough, so I can’t really explain why my heart rate has dropped so much without a corresponding increase in performance. One possible explanation is I have moved from being bottlenecked by the performance of my cardiovascular system to being bottlenecked by the performance of my legs, but that these two bottlenecks are very similar in terms of where they cap my pace.</p>
<p>It was pretty fun having a look in R. Here’s a <a href="http://rpubs.com/Chris_Beeley/analysis5K">link to the analysis</a> as it stands.</p>
<p>I thought I would look at my race strategy in terms of how fast I went at each point, reasoning that maybe I let myself down on the hills or the straights or something in the second attempt. However, as you can see the pace is absolutely identical the whole way in both runs. The heart rate, as you can see, is consistently lower in the second run, and it only creeps up at the end for the sprint finish (which makes me wonder if I really was pushing myself hard enough).</p>
<p>I need to do more analysis. My next idea is to look at the relationship between incline, heart rate, and pace (the route is pretty hilly so this is quite important).</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=1052/">
            <div class="card-body">

                <h3 class="fw-bold post-title">New Year blog post</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;January 26, 2018 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>So my favourite productivity guru, David Allen, he of <a href="https://gettingthingsdone.com/">Getting Things Done</a> fame, has a suggestion for a New Year review that you should carry out each year. His <a href="https://www.improvisedlife.com/2012/01/09/david-allens-potent-questions-for-a-new-year/">suggested structure</a> can be found here.</p>
<p>I think this is an excellent idea so I have set myself a recurring reminder to do it each year, starting now. And I may as well blog it so I can find it again and anyone else who’s interested can have a read and maybe be inspired to do their own.</p>
<p>I had a bit of a rough year in 2017 and required surgery to remove my colon and spleen after a long battle with ulcerative colitis, so the 2017 bit is going to be a bit shorter than it will be next year. Still, I did achieve some stuff so let’s have a look.</p>
<p>The most sort of visible thing I did this year was make some videos about Shiny. There are two courses, and they’re available to buy (or you can watch them with a subscription) at the links <a href="https://www.packtpub.com/virtualization-and-cloud/getting-started-shiny-video">Getting Started with Shiny</a> and <a href="https://www.packtpub.com/big-data-and-business-intelligence/ui-development-shiny-video">UI Development with Shiny</a>. There are some angry people on Amazon reviewing my book who clearly wanted it to have more advanced applications in so I’ll warn you here they don’t feature any highly complex applications. They’re more for people who are starting out. I have another one coming out soon called Advanced Shiny, I can’t link to it yet because it doesn’t exist. Again that’s sort of moderately advanced- interacting with databases, JavaScript, adding a password, stuff like that. So don’t buy them or subscribe to the video service hoping for some real high level stuff, because it’s not in there. I’d hate for you to feel like you wasted your money.</p>
<p>Anyway, I also started doing a lot of work with Shiny at work, it’s taking off in a big way, and when I talk about 2018 I’ll be saying that I’ve got big plans at work, my role is developing quite a lot based on what we’ve achieved already in 2017. I’ve also learned quite a lot of stuff about text analytics, with the hope of relaunching a Shiny application I wrote a few years back and currently maintain with a lot of tools in it to allow the user to explore text based data. I’ll say more about that next year when I’ve actually done it.</p>
<p>I also learned how to implement an API in PHP, which is pretty easy really when you know how but it was cool to learn anyway.</p>
<p>I was in the right place at the right time, really, at work, in terms of having the experience with Shiny that I do and being able to help with this project that’s developing, so I’ve been quite lucky to be on board but I also give myself some credit for reading the runes and training myself up in Shiny to be ready to help with something like this. The skills I’ve acquired both in Shiny programming and in running Linux servers to run Shiny Server and relevant databases on are suddenly very valuable to my organisation, so I feel I called this one correctly. My next prediction is text analysis, I feel like if I can learn that and do it really well over the next five years then there could be opportunities there.</p>
<p>In terms of my personal life, really it feels like all I did was be very, very ill with severe inflammatory bowel disease and then have surgery to correct it. That consumed a lot of my energy, really. I’ve now recovered and I’m back doing 10 mile runs at the weekend, which is great. I’ve actually very tentatively started writing a book about my experiences being ill, which I’ll talk about more if I actually get anywhere with it next year.</p>
<p>So in 2018 I’ll be developing my role at work, and having much more input more widely across the organisation both in terms of Shiny, live analytics, dashboards and all that stuff, but also in terms of statistics and analysing real datasets from healthcare services, which is where I started out, really, finishing my psychology PhD in 2008 looking at routinely collected data in psychiatric hospitals with mixed effects models. And as I mentioned I’ll be improving one of my Shiny applications, adding a lot of tools to help users explore the text.</p>
<p>In my personal life I want to be a really good dad since my kids got a bit of raw deal with my being sick in 2017 and I’m going to run a marathon in less than four hours. I didn’t run for 3 years or so because of having liver disease and then bowel disease so I really owe it to myself to get a nice marathon PB under my belt (current PB is 4’14”). And I’m going to try to clear the decks a bit and get writing a book about my experiences being ill, a lot of people have told me that they think it would be good so I’m going to have a go.</p>
<p>David Allen has some questions, I missed out the ones for the year just gone because it was such a strange year, but let’s look at some for 2018.</p>
<p>What would you like to be your biggest triumph in 2018?<br>
If I can make this new job role work then I’ll be really pleased because it’s a big important step up for me and I think it will be really valuable to the Trust. And I really want to run a sub 4 marathon. If I can do those two things, I’m happy.</p>
<p>What is the major effort you are planning to improve your financial results in 2018?<br>
I’ve actually got a savings account now, after being hopeless with money in the past. I’m really trying to save up for things instead of impulsively buying them, and with a bit of luck I can treat myself to a beautiful <a href="https://www.entroware.com/store/apollo">Entroware laptop</a> in 2018</p>
<p>What major indulgence are you willing to experience in 2018?<br>
Now the kids are a bit older I’d love to go on a skiing holiday with them. I love snowboarding and haven’t been for ages.</p>
<p>What would you most like to change about yourself in 2018?<br>
Definitely better organised and less forgetful. I’m really trying hard at the moment to put reminders in my phone for everything, work stuff, buying presents, stuff for my kids, everything.</p>
<p>What is one as yet undeveloped talent you are willing to explore in 2018?<br>
I’m really going to have to get big picture mode at work. I’ve had my head down learning the stack for processing patient experience data, but in 2018 I need to work much more widely- with say finance data, or HR, clinical outcomes. I’m really looking forward to getting my teeth into that.</p>
<p>What brings you the most joy and how are you going to do or have more of that in 2018?<br>
Running. Lots and lots and lots of lovely running. I’m making time to do that, already am.</p>
<p>Who or what, other than yourself, are you most committed to loving and serving in 2018?<br>
My kids deserve a really good dad who’s not ill all the time, and that’s exactly what they’re going to get.</p>
<p>What one word would you like to have as your theme in 2018?<br>
Health. Beautiful, glorious, wonderful health.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
          <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6  mb-4">
    <div class="card h-100 single-post-card shadow-effect bg-faded-light">
        <a href="http://localhost:1313/chris_beeley_blog/?p=1042/">
            <div class="card-body">

                <h3 class="fw-bold post-title">Gathering data (wide to long) in the tidyverse</h3>
                

                <p class="post-meta">
                    <span class="post-meta">
  
  
  &nbsp;January 22, 2018 

  

  
  
  
</span>


                </p>
                
                <div class="post-entry">

                    
                    <p>I seem to have a pretty severe mental block about the gather() function from dplyr so this is yet another post that to be honest is basically for me to refer to in 6 months when I forget all this stuff. So I’m going to address the mental block I have very specifically and show some code; hopefully it will help someone else out there.</p>
<p>So whenever I use gather I put the whole dataframe in. Say I’ve got ten variables. I whack the whole dataframe in and try to pull out just the ones I want using the select() notation at the end of the list of arguments. This DOES NOT MAKE ANY SENSE. You can’t do this:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

theData = tibble(ID = 1:10, Q1 = runif(10),
  Q2 = runif(10),
  Q3 = runif(10),
  Q4 = runif(10),
  Q5 = runif(10))

gather(theData, key = Question, value = Score, Q1, Q2, Q3)
</code></pre><p>This does not work! I don’t know why I think it does! What do I think is going to happen to the ID column? It’s just going to magically go away?</p>
<p>I DON’T KNOW WHY I’M SO BAD AT THIS.</p>
<p>It’s going to gather the whole dataframe, and you just end up with a huge mess. The other thing to say is, and I have started to get the hang of this, but just in case. THE KEY AND VALUE ARGUMENTS YOU JUST MAKE UP. THEY ARE *NOT* RELATED TO THE NAMES OF THE DATAFRAME AT ALL.</p>
<p>What you actually do is get JUST THE VARIABLES YOU WANT, and then you need to decide whether you want any other variables, but not gather them. So as a concrete example, let’s say you want to gather Q1 – Q3 and keep the ID column. You want to put the ID column in, but you don’t want to GATHER it. So you put it in the select statement, but use -ID in the gather statement:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

testData %&gt;%
  select(ID : Q3) %&gt;%
  gather(key = Question, value = Score, -ID)

# A tibble: 30 x 3
  ID Question Score
  &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
 1 1 Q1 0.26001265
 2 2 Q1 0.34674771
 3 3 Q1 0.43080742
 4 4 Q1 0.28397929
 5 5 Q1 0.14545496
 6 6 Q1 0.63496928
 7 7 Q1 0.78777785
 8 8 Q1 0.44622476
 9 9 Q1 0.86785324
10 10 Q1 0.02611436
# ... with 20 more rows
</code></pre><p>Or if you don’t want the ID column (not doing anything useful in this particular, made up, case):</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

testData %&gt;%
  select(Q1 : Q3) %&gt;%
  gather(key = Question, value = Score, Q1 : Q3)

# A tibble: 30 x 2
  Question Score
  &lt;chr&gt; &lt;dbl&gt;
 1 Q1 0.26001265
 2 Q1 0.34674771
 3 Q1 0.43080742
 4 Q1 0.28397929
 5 Q1 0.14545496
 6 Q1 0.63496928
 7 Q1 0.78777785
 8 Q1 0.44622476
 9 Q1 0.86785324
10 Q1 0.02611436
# ... with 20 more rows
</code></pre><p>Note that by default it will include ALL variables anyway, so this is totally equivalent to:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;

testData %&gt;%
  select(Q1 : Q3) %&gt;%
  gather(key = Question, value = Score)
</code></pre><p>That’s it! As I said at the beginning of the post, I have no idea why I have such a ridiculous mental block about it, it’s all in the documentation, I just get all the columns references and the – notation and all that stuff mixed up (I think partly because using -ID KEEPS the ID variable, it just doesn’t GATHER it). It’s my fault for being an idiot, but the next time I get stuck I’ll read this and understand clearly 🙂</p>
<p>Oh yes, last thing, Q1 : Q3 is just “from Q1 to Q3”, meaing Q1, Q2, and Q3, and Q3 : Q5 would be Q3, Q4, Q5 etc. There are lots of ways to select the variables. See more at ?gather and ?select (which uses the same variable name rules).</p>
<p>One neat trick is num_range(), which is a shortcut to selecting ranges of things like Q1, Q2, Q3, X1, X2, X3 and so on. You just give the prefix and the numbers you want-</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: r; title: ; notranslate&#34; title=&#34;&#34;&gt;

testData %&gt;%
  select(num_range(&#34;Q&#34;, 1:3)) %&gt;%
  gather(key = Question, value = Score)
</code></pre><p>Right, I’ll stop now, this post is getting too long.</p>

                    
                </div>

                <div class="read-more-section">
                    <h6>Read more</h6>
                </div>
            </div>

            
            
        </a>
    </div>
</div> 
        
      </div>
    </div>
  </div>
</div>

<div class="container">
 <div class="row font-sans"> 
   <div class="col-md-12 mt-10">
      <nav aria-label="Page navigation"> 
      <ul class= "pagination justify-content-end">    
      
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/11/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/10/" aria-label="Page 10" class="page-link" role="button">10</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/11/" aria-label="Page 11" class="page-link" role="button">11</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 12" class="page-link" role="button">12</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/13/" aria-label="Page 13" class="page-link" role="button">13</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/14/" aria-label="Page 14" class="page-link" role="button">14</a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/13/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/chris_beeley_blog/categories/Uncategorized/page/29/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul> 
      </ul>
      </nav> 
    </div>
  </div>
</div>


    


<footer>

  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <ul
          class="list-inline list-group list-group-horizontal text-center footer-links d-flex justify-content-center flex-row">

          
          
        </ul>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
          2023
          

          
          &nbsp;&bull;&nbsp;
          <a href="http://localhost:1313/chris_beeley_blog/">Chris Beeley&#39;s blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          Powered by <a href="https://gohugo.io">Hugo</a> & <a href="https://github.com/binokochumolvarghese/lightbi-hugo">Lightbi.</a>&nbsp; Made with ❤ by <a href="https://binovarghese.com">Bino</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script><script src="http://localhost:1313/chris_beeley_blog/js/dark-mode.js"></script>
    
  </body>
</html>

